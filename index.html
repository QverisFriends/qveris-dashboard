<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qveris æ™ºèƒ½ç”Ÿæ´»ä»ªè¡¨ç›˜</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            min-height: 100vh;
            color: #fff;
            padding: 20px;
        }
        .container { max-width: 1400px; margin: 0 auto; }
        .header { text-align: center; padding: 30px 0; }
        .header h1 { font-size: 2.5em; margin-bottom: 10px; background: linear-gradient(90deg, #667eea, #764ba2); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .clock { font-size: 1.5em; color: #667eea; margin-bottom: 5px; }
        .date { color: #888; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px; padding: 20px 0; }
        .card {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px;
            border: 1px solid rgba(255,255,255,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .card:hover { transform: translateY(-5px); box-shadow: 0 10px 40px rgba(102, 126, 234, 0.2); }
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .card-header h2 { font-size: 1.2em; display: flex; align-items: center; gap: 10px; }
        .card-header i { color: #667eea; }
        .refresh-btn { background: rgba(255,255,255,0.1); border: none; color: #fff; padding: 8px 12px; border-radius: 8px; cursor: pointer; transition: all 0.3s ease; }
        .refresh-btn:hover { background: rgba(102, 126, 234, 0.3); }
        .loading { text-align: center; padding: 30px; color: #888; }
        .spinner { width: 40px; height: 40px; border: 3px solid rgba(255,255,255,0.1); border-top-color: #667eea; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 15px; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .api-badge { font-size: 0.7em; background: rgba(102, 126, 234, 0.3); padding: 2px 8px; border-radius: 10px; margin-left: 8px; }
        
        /* å¤©æ°”æ ·å¼ */
        .weather-location { text-align: center; font-size: 1.2em; margin-bottom: 10px; }
        .weather-main { text-align: center; font-size: 3em; margin: 15px 0; }
        .weather-desc { text-align: center; font-size: 1.1em; color: #ddd; margin-bottom: 20px; }
        .weather-details { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
        .weather-detail { background: rgba(255,255,255,0.05); padding: 12px; border-radius: 10px; text-align: center; }
        .weather-detail-label { font-size: 0.8em; color: #aaa; margin-bottom: 5px; }
        .weather-detail-value { font-size: 1.1em; font-weight: bold; }
        
        /* è‚¡ç¥¨æ ·å¼ */
        .stock-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .stock-name { font-size: 1.3em; font-weight: bold; margin-bottom: 5px; }
        .stock-price { font-size: 2em; font-weight: bold; color: #667eea; }
        .stock-change { font-size: 1em; margin-left: 10px; }
        .stock-details { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
        .stock-detail { background: rgba(255,255,255,0.05); padding: 10px; border-radius: 8px; text-align: center; }
        .stock-detail-label { font-size: 0.75em; color: #aaa; }
        .stock-detail-value { font-size: 0.95em; font-weight: bold; margin-top: 3px; }
        .stock-chart { width: 100%; height: 150px; margin-top: 15px; }
        
        /* æ–°é—»æ ·å¼ */
        .news-item { background: rgba(255,255,255,0.03); padding: 12px; margin-bottom: 10px; border-radius: 10px; border-left: 3px solid #667eea; cursor: pointer; transition: all 0.3s ease; }
        .news-item:hover { background: rgba(102, 126, 234, 0.1); }
        .news-title { font-weight: bold; margin-bottom: 5px; font-size: 0.95em; }
        .news-meta { font-size: 0.75em; color: #888; display: flex; justify-content: space-between; }
        
        /* æ±‡ç‡æ ·å¼ */
        .rate-item { display: flex; justify-content: space-between; align-items: center; padding: 12px; background: rgba(255,255,255,0.05); border-radius: 10px; margin-bottom: 8px; }
        .rate-pair { display: flex; align-items: center; gap: 10px; }
        .rate-icon { width: 30px; height: 30px; border-radius: 50%; background: linear-gradient(135deg, #667eea, #764ba2); display: flex; align-items: center; justify-content: center; font-size: 0.8em; }
        .rate-value { font-weight: bold; color: #667eea; }
        
        /* ä½ç½®æ ·å¼ */
        .location-item { padding: 10px; margin-bottom: 8px; display: flex; align-items: center; gap: 10px; }
        .location-icon { width: 35px; height: 35px; background: rgba(102, 126, 234, 0.2); border-radius: 10px; display: flex; align-items: center; justify-content: center; color: #667eea; }
        .location-label { font-size: 0.8em; color: #aaa; }
        .location-value { font-weight: bold; }
        
        /* å¯¹è¯æ ·å¼ */
        .chat-container { height: 300px; overflow-y: auto; padding: 10px; background: rgba(0,0,0,0.2); border-radius: 10px; margin-bottom: 10px; }
        .chat-message { margin-bottom: 10px; padding: 10px 15px; border-radius: 15px; max-width: 85%; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .chat-user { background: linear-gradient(135deg, #667eea, #764ba2); margin-left: auto; border-bottom-right-radius: 5px; }
        .chat-assistant { background: rgba(255,255,255,0.1); margin-right: auto; border-bottom-left-radius: 5px; }
        .chat-input-container { display: flex; gap: 10px; }
        .chat-input { flex: 1; padding: 12px 15px; border-radius: 25px; border: 1px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.05); color: #fff; font-size: 1em; outline: none; }
        .chat-input:focus { border-color: #667eea; }
        .chat-btn { background: linear-gradient(135deg, #667eea, #764ba2); border: none; color: #fff; padding: 12px 25px; border-radius: 25px; cursor: pointer; font-size: 1em; transition: all 0.3s ease; }
        .chat-btn:hover { transform: scale(1.05); box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4); }
        .chat-btn:disabled { opacity: 0.5; cursor: not-allowed; }
        
        /* å›¾ç‰‡ç”Ÿæˆæ ·å¼ */
        .image-prompt { width: 100%; padding: 12px; border-radius: 10px; border: 1px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.05); color: #fff; font-size: 1em; margin-bottom: 10px; resize: vertical; }
        .image-result { text-align: center; margin-top: 15px; }
        .generated-image { max-width: 100%; border-radius: 10px; cursor: pointer; }
        
        /* æœç´¢æ¡†æ ·å¼ */
        .search-container { margin-bottom: 15px; }
        .search-input { width: 100%; padding: 12px 15px; border-radius: 10px; border: 1px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.05); color: #fff; font-size: 1em; outline: none; }
        .search-input:focus { border-color: #667eea; }
        .tools-list { max-height: 400px; overflow-y: auto; }
        .tool-item { background: rgba(255,255,255,0.03); padding: 15px; border-radius: 10px; margin-bottom: 10px; border-left: 3px solid #667eea; cursor: pointer; transition: all 0.3s ease; }
        .tool-item:hover { background: rgba(102, 126, 234, 0.1); }
        .tool-name { font-weight: bold; margin-bottom: 5px; display: flex; align-items: center; gap: 8px; }
        .tool-desc { font-size: 0.85em; color: #aaa; margin-bottom: 8px; }
        .tool-meta { display: flex; gap: 15px; font-size: 0.75em; color: #888; }
        .tool-meta span { display: flex; align-items: center; gap: 5px; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; justify-content: center; align-items: center; }
        .modal.show { display: flex; }
        .modal-content { background: #1a1a2e; border-radius: 20px; padding: 30px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .modal-close { background: none; border: none; color: #fff; font-size: 1.5em; cursor: pointer; }
        .modal-body pre { background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px; overflow-x: auto; font-size: 0.85em; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="clock" id="clock">00:00:00</div>
            <div class="date" id="date">åŠ è½½ä¸­...</div>
            <h1>ğŸŒ Qveris æ™ºèƒ½ç”Ÿæ´»ä»ªè¡¨ç›˜</h1>
            <p style="color: #888; margin-top: 10px;">åŸºäº Qveris API çš„å¤šåŠŸèƒ½æ™ºèƒ½åŠ©æ‰‹</p>
        </div>
        
        <div class="grid">
            <!-- å¤©æ°”å¡ç‰‡ -->
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-cloud-sun"></i>
                    <h2>å¤©æ°”é¢„æŠ¥ <span class="api-badge">WeatherAPI</span></h2>
                    <button class="refresh-btn" onclick="fetchWeather()"><i class="fas fa-sync-alt"></i></button>
                </div>
                <div id="weather-content">
                    <div class="loading"><div class="spinner"></div><p>åŠ è½½ä¸­...</p></div>
                </div>
            </div>
            
            <!-- è‚¡ç¥¨å¡ç‰‡ -->
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-chart-line"></i>
                    <h2>è‚¡ç¥¨è¡Œæƒ… <span class="api-badge">NVDA</span></h2>
                    <button class="refresh-btn" onclick="fetchStock()"><i class="fas fa-sync-alt"></i></button>
                </div>
                <div id="stock-content">
                    <div class="loading"><div class="spinner"></div><p>åŠ è½½ä¸­...</p></div>
                </div>
            </div>
            
            <!-- AIå¯¹è¯å¡ç‰‡ -->
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-robot"></i>
                    <h2>AI æ™ºèƒ½åŠ©æ‰‹ <span class="api-badge">Groq</span></h2>
                </div>
                <div class="chat-container" id="chat-container">
                    <div class="chat-message chat-assistant">ä½ å¥½ï¼æˆ‘æ˜¯Qveris AIåŠ©æ‰‹ï¼Œæœ‰ä»€ä¹ˆå¯ä»¥å¸®åŠ©ä½ çš„å—ï¼Ÿ</div>
                </div>
                <div class="chat-input-container">
                    <input type="text" class="chat-input" id="chat-input" placeholder="è¾“å…¥æ¶ˆæ¯..." onkeypress="if(event.key==='Enter')sendMessage()">
                    <button class="chat-btn" onclick="sendMessage()" id="chat-btn">å‘é€</button>
                </div>
            </div>
            
            <!-- ç§‘æŠ€æ–°é—»å¡ç‰‡ -->
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-newspaper"></i>
                    <h2>ç§‘æŠ€æ–°é—» <span class="api-badge">NewsData</span></h2>
                    <button class="refresh-btn" onclick="fetchNews()"><i class="fas fa-sync-alt"></i></button>
                </div>
                <div id="news-content" style="max-height: 300px; overflow-y: auto;">
                    <div class="loading"><div class="spinner"></div><p>åŠ è½½ä¸­...</p></div>
                </div>
            </div>
            
            <!-- æ±‡ç‡å¡ç‰‡ -->
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-money-bill-wave"></i>
                    <h2>æ±‡ç‡è½¬æ¢ <span class="api-badge">Frankfurter</span></h2>
                    <button class="refresh-btn" onclick="fetchRates()"><i class="fas fa-sync-alt"></i></button>
                </div>
                <div id="rates-content">
                    <div class="loading"><div class="spinner"></div><p>åŠ è½½ä¸­...</p></div>
                </div>
            </div>
            
            <!-- ä½ç½®å¡ç‰‡ -->
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-map-marker-alt"></i>
                    <h2>ä½ç½®æŸ¥è¯¢ <span class="api-badge">ç™¾åº¦åœ°å›¾</span></h2>
                    <button class="refresh-btn" onclick="fetchLocation()"><i class="fas fa-sync-alt"></i></button>
                </div>
                <div id="location-content">
                    <div class="loading"><div class="spinner"></div><p>åŠ è½½ä¸­...</p></div>
                </div>
            </div>
            
            <!-- AIå›¾ç‰‡ç”Ÿæˆå¡ç‰‡ -->
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-palette"></i>
                    <h2>AI å›¾ç‰‡ç”Ÿæˆ <span class="api-badge">æ™ºè°±AI CogView-3</span></h2>
                </div>
                <div style="padding: 10px;">
                    <div style="margin-bottom: 10px;">
                        <label style="display: block; color: #aaa; font-size: 0.85em; margin-bottom: 5px;">âœ¨ æè¿°ä½ æƒ³è¦ç”Ÿæˆçš„å›¾ç‰‡</label>
                        <textarea id="image-prompt" class="image-prompt" rows="3" placeholder="ä¾‹å¦‚ï¼šä¸€åªæ©™è‰²çš„å°çŒ«åœ¨è‰åœ°ä¸Šç©è€ï¼Œé˜³å…‰æ˜åªš..."></textarea>
                    </div>
                    <div style="margin-bottom: 10px;">
                        <label style="display: block; color: #aaa; font-size: 0.85em; margin-bottom: 5px;">ğŸ“ å›¾ç‰‡å°ºå¯¸</label>
                        <select id="image-size" style="width: 100%; padding: 10px; border-radius: 10px; border: 1px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.05); color: #fff;">
                            <option value="1024*1024">1024x1024 (é«˜æ¸…æ­£æ–¹å½¢)</option>
                            <option value="768*768">768x768 (ä¸­ç­‰å°ºå¯¸)</option>
                            <option value="512*512">512x512 (å¿«é€Ÿç”Ÿæˆ)</option>
                        </select>
                    </div>
                    <button class="chat-btn" style="width: 100%;" onclick="generateImage()">
                        <i class="fas fa-magic"></i> ç”ŸæˆAIå›¾ç‰‡
                    </button>
                    <p style="font-size: 0.75em; color: #888; text-align: center; margin-top: 8px;">
                        â±ï¸ å¯èƒ½éœ€è¦10-30ç§’ï¼Œè¯·è€å¿ƒç­‰å¾…
                    </p>
                    <div id="image-result"></div>
                </div>
            </div>
            
            <!-- APIæ¢ç´¢å™¨å¡ç‰‡ -->
            <div class="card" style="grid-column: span 2;">
                <div class="card-header">
                    <i class="fas fa-search"></i>
                    <h2>Qveris API æ¢ç´¢å™¨ <span class="api-badge">å‘ç°1000+å·¥å…·</span></h2>
                </div>
                <div style="margin-bottom: 15px;">
                    <div class="search-container">
                        <input type="text" class="search-input" id="tool-search" placeholder="ğŸ” æœç´¢å·¥å…· (ä¾‹å¦‚: weather, stock, AI, translation, image generation...)" onkeypress="if(event.key==='Enter')searchTools()">
                    </div>
                    <div style="display: flex; gap: 10px; margin-top: 10px; flex-wrap: wrap;">
                        <button class="chat-btn" onclick="searchTools()">
                            <i class="fas fa-search"></i> æœç´¢
                        </button>
                        <button class="chat-btn" onclick="searchTools('popular')" style="background: rgba(102, 126, 234, 0.3);">
                            <i class="fas fa-fire"></i> çƒ­é—¨å·¥å…·
                        </button>
                        <button class="chat-btn" onclick="searchTools('weather')" style="background: rgba(0, 184, 148, 0.3);">
                            <i class="fas fa-cloud"></i> å¤©æ°”
                        </button>
                        <button class="chat-btn" onclick="searchTools('stock')" style="background: rgba(253, 203, 110, 0.3);">
                            <i class="fas fa-chart-line"></i> è‚¡ç¥¨
                        </button>
                        <button class="chat-btn" onclick="searchTools('AI')" style="background: rgba(155, 89, 182, 0.3);">
                            <i class="fas fa-robot"></i> AI
                        </button>
                        <button class="chat-btn" onclick="searchTools('image')" style="background: rgba(231, 76, 60, 0.3);">
                            <i class="fas fa-image"></i> å›¾ç‰‡
                        </button>
                    </div>
                </div>
                <div class="tools-list" id="tools-list">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®æˆ–è¾“å…¥å…³é”®è¯æœç´¢å·¥å…·...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- æ¨¡æ€æ¡† -->
    <div class="modal" id="result-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>å·¥å…·æ‰§è¡Œç»“æœ</h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body" id="modal-body"></div>
        </div>
    </div>
    
    <script>
        // APIé…ç½®
        const API_KEY = 'sk-VeJWtelcfNcqgm6H-V_TfkWX4Or2IyskjXqBvBszQ-k';
        const BASE_URL = 'https://qveris.ai/api/v1';
        
        // æ—¶é’Ÿæ›´æ–°
        function updateClock() {
            const now = new Date();
            document.getElementById('clock').textContent = now.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
            document.getElementById('date').textContent = now.toLocaleDateString('zh-CN', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
        }
        setInterval(updateClock, 1000);
        updateClock();
        
        // ========== å¤©æ°”API ==========
        async function fetchWeather() {
            const content = document.getElementById('weather-content');
            content.innerHTML = '<div class="loading"><div class="spinner"></div><p>åŠ è½½ä¸­...</p></div>';
            
            try {
                const response = await fetch(`${BASE_URL}/tools/execute?tool_id=weather_api.current.retrieve.v1.dca6c0f0`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${API_KEY}` },
                    body: JSON.stringify({ search_id: '', session_id: '', parameters: { q: 'Beijing', aqi: 'yes' }, max_response_size: 20480 })
                });
                const data = await response.json();
                
                if (data.success && data.result?.data) {
                    const w = data.result.data;
                    const c = w.current;
                    content.innerHTML = `
                        <div class="weather-location"><i class="fas fa-map-marker-alt"></i> ${w.location?.name || 'åŒ—äº¬'}</div>
                        <div class="weather-main">${getWeatherIcon(c.condition?.text)}</div>
                        <div class="weather-desc">${c.condition?.text || 'æœªçŸ¥'}</div>
                        <div class="weather-details">
                            <div class="weather-detail"><div class="weather-detail-label">æ¸©åº¦</div><div class="weather-detail-value">${Math.round(c.temp_c)}Â°C</div></div>
                            <div class="weather-detail"><div class="weather-detail-label">æ¹¿åº¦</div><div class="weather-detail-value">${c.humidity}%</div></div>
                            <div class="weather-detail"><div class="weather-detail-label">é£é€Ÿ</div><div class="weather-detail-value">${c.wind_kph} km/h</div></div>
                            <div class="weather-detail"><div class="weather-detail-label">ç©ºæ°”è´¨é‡</div><div class="weather-detail-value">${c.air_quality?.['us-epa-index'] || '-'}</div></div>
                        </div>
                    `;
                } else {
                    content.innerHTML = '<p style="text-align: center; color: #ff6b6b;">å¤©æ°”åŠ è½½å¤±è´¥</p>';
                }
            } catch (error) {
                console.error('Weather error:', error);
                content.innerHTML = '<p style="text-align: center; color: #ff6b6b;">å¤©æ°”åŠ è½½å¤±è´¥</p>';
            }
        }
        
        function getWeatherIcon(condition) {
            const icons = { 'Sunny': '<i class="fas fa-sun" style="color: #f1c40f;"></i>', 'Clear': '<i class="fas fa-moon" style="color: #9b59b6;"></i>', 'Cloudy': '<i class="fas fa-cloud" style="color: #3498db;"></i>', 'Rain': '<i class="fas fa-cloud-rain" style="color: #2980b9;"></i>', 'Snow': '<i class="fas fa-snowflake" style="color: #ecf0f1;"></i>' };
            return icons[condition] || '<i class="fas fa-cloud-sun"></i>';
        }
        
        // ========== è‚¡ç¥¨API ==========
        async function fetchStock() {
            const content = document.getElementById('stock-content');
            content.innerHTML = '<div class="loading"><div class="spinner"></div><p>åŠ è½½ä¸­...</p></div>';
            
            try {
                const response = await fetch(`${BASE_URL}/tools/execute?tool_id=financial_modeling_prep.stock.quote.retrieve.v1.822497ca`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${API_KEY}` },
                    body: JSON.stringify({ search_id: '', session_id: '', parameters: { symbol: 'NVDA' }, max_response_size: 20480 })
                });
                const data = await response.json();
                
                if (data.success && data.result?.data?.[0]) {
                    const s = data.result.data[0];
                    const change = s.change || 0;
                    const pct = (s.changePercentage || 0) * 100;
                    const isUp = change >= 0;
                    
                    content.innerHTML = `
                        <div class="stock-header">
                            <div>
                                <div class="stock-name">${s.symbol} - ${s.name || 'NVIDIA'}</div>
                                <div><span class="stock-price">$${s.price?.toFixed(2) || '--'}</span>
                                <span class="stock-change" style="color: ${isUp ? '#00b894' : '#ff6b6b'}">${isUp ? '+' : ''}${change.toFixed(2)} (${isUp ? '+' : ''}${pct.toFixed(2)}%)</span></div>
                            </div>
                            <i class="fas fa-${isUp ? 'caret-up' : 'caret-down'}" style="font-size: 2em; color: ${isUp ? '#00b894' : '#ff6b6b'}"></i>
                        </div>
                        <div class="stock-details">
                            <div class="stock-detail"><div class="stock-detail-label">å¼€ç›˜</div><div class="stock-detail-value">$${s.open?.toFixed(2) || '-'}</div></div>
                            <div class="stock-detail"><div class="stock-detail-label">æœ€é«˜</div><div class="stock-detail-value">$${s.dayHigh?.toFixed(2) || '-'}</div></div>
                            <div class="stock-detail"><div class="stock-detail-label">æœ€ä½</div><div class="stock-detail-value">$${s.dayLow?.toFixed(2) || '-'}</div></div>
                            <div class="stock-detail"><div class="stock-detail-label">æˆäº¤é‡</div><div class="stock-detail-value">${(s.volume / 1000000).toFixed(1)}M</div></div>
                        </div>
                    `;
                } else {
                    content.innerHTML = '<p style="text-align: center; color: #ff6b6b;">è‚¡ç¥¨åŠ è½½å¤±è´¥</p>';
                }
            } catch (error) {
                console.error('Stock error:', error);
                content.innerHTML = '<p style="text-align: center; color: #ff6b6b;">è‚¡ç¥¨åŠ è½½å¤±è´¥</p>';
            }
        }
        
        // ========== AIå¯¹è¯API ==========
        let chatMessages = [];
        
        // ç®€å•çš„æœ¬åœ°å›å¤æœºå™¨äººï¼ˆå¤‡ç”¨æ–¹æ¡ˆï¼‰
        const localResponses = [
            "ä½ å¥½ï¼æˆ‘æ˜¯Qveris AIåŠ©æ‰‹ï¼Œå¾ˆé«˜å…´ä¸ºä½ æœåŠ¡ï¼",
            "è¿™ä¸ªé—®é¢˜å¾ˆæœ‰è¶£ï¼Œè®©æˆ‘æ€è€ƒä¸€ä¸‹...",
            "æˆ‘å¯ä»¥å¸®ä½ æŸ¥è¯¢å¤©æ°”ã€è‚¡ç¥¨ã€æ–°é—»ç­‰ä¿¡æ¯ã€‚",
            "è¯·å°è¯•é—®æˆ‘å…³äºç§‘æŠ€ã€ç”Ÿæ´»ã€æŠ•èµ„æ–¹é¢çš„é—®é¢˜ã€‚",
            "ä»Šå¤©å¤©æ°”ä¸é”™ï¼Œé€‚åˆå¤–å‡ºæ•£æ­¥ï¼",
            "æˆ‘å¯ä»¥å¸®ä½ æœç´¢å„ç§APIå·¥å…·ã€‚",
            "è¯·å‘Šè¯‰æˆ‘ä½ éœ€è¦ä»€ä¹ˆå¸®åŠ©ï¼Ÿ",
            "Qveriså¹³å°æä¾›äº†å¾ˆå¤šå¼ºå¤§çš„AIå·¥å…·ã€‚",
            "ä½ æ„Ÿå…´è¶£çš„è¯é¢˜æ˜¯ä»€ä¹ˆï¼Ÿ",
            "æˆ‘å¯ä»¥å›ç­”ç®€å•çš„é—®é¢˜ï¼Œæ›´å¤æ‚çš„é—®é¢˜å¯èƒ½éœ€è¦æ›´é«˜çº§çš„APIã€‚"
        ];
        
        function getLocalResponse(message) {
            const lowerMessage = message.toLowerCase();
            
            if (lowerMessage.includes('å¤©æ°”')) return "ä½ å¯ä»¥ä½¿ç”¨é¡µé¢ä¸Šçš„å¤©æ°”å¡ç‰‡æŸ¥çœ‹åŒ—äº¬å®æ—¶å¤©æ°”ï¼";
            if (lowerMessage.includes('è‚¡ç¥¨')) return "è‚¡ç¥¨å¡ç‰‡æ˜¾ç¤ºNVIDIAçš„å®æ—¶è¡Œæƒ…ï¼Œè¯·æŸ¥çœ‹ä¸Šæ–¹æ•°æ®ã€‚";
            if (lowerMessage.includes('æ–°é—»')) return "ç§‘æŠ€æ–°é—»æ¯5åˆ†é’Ÿè‡ªåŠ¨æ›´æ–°ä¸€æ¬¡ã€‚";
            if (lowerMessage.includes('ä½ å¥½') || lowerMessage.includes('hi') || lowerMessage.includes('hello')) return "ä½ å¥½ï¼æœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®åŠ©ä½ çš„å—ï¼Ÿ";
            if (lowerMessage.includes('åå­—') || lowerMessage.includes('è°')) return "æˆ‘æ˜¯Qverisæ™ºèƒ½åŠ©æ‰‹ï¼ŒåŸºäºQveris AIå¹³å°ã€‚";
            if (lowerMessage.includes('å¸®åŠ©')) return "æˆ‘å¯ä»¥ï¼š\n1. å›ç­”ç®€å•é—®é¢˜\n2. ä»‹ç»å„ç§åŠŸèƒ½\n3. æä¾›å¤©æ°”ã€è‚¡ç¥¨ç­‰ä¿¡æ¯";
            
            return localResponses[Math.floor(Math.random() * localResponses.length)];
        }
        
        async function sendMessage() {
            const input = document.getElementById('chat-input');
            const btn = document.getElementById('chat-btn');
            const container = document.getElementById('chat-container');
            const message = input.value.trim();
            
            if (!message) return;
            
            input.value = '';
            container.innerHTML += `<div class="chat-message chat-user">${message}</div>`;
            chatMessages.push({ role: 'user', content: message });
            
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> æ€è€ƒä¸­...';
            container.innerHTML += `<div class="chat-message chat-assistant" id="typing"><i class="fas fa-ellipsis-h"></i> æ­£åœ¨æ€è€ƒ...</div>`;
            container.scrollTop = container.scrollHeight;
            
            try {
                console.log('Sending message to AI...');
                const response = await fetch(`${BASE_URL}/tools/execute?tool_id=groq.groqapi.chat.completions.create.v1.19d0750a`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${API_KEY}` },
                    body: JSON.stringify({ search_id: '', session_id: '', parameters: { model: 'meta-llama/llama-4-maverick-17b-128e-instruct', messages: chatMessages, max_tokens: 500 }, max_response_size: 20480 })
                });
                const data = await response.json();
                console.log('AI Response:', data);
                
                document.getElementById('typing').remove();
                
                // æ£€æŸ¥æ˜¯å¦æˆåŠŸ
                if (data.success && data.result?.data?.choices?.length > 0) {
                    const choices = data.result.data.choices;
                    const content = choices[0]?.message?.content || '';
                    
                    if (content) {
                        container.innerHTML += `<div class="chat-message chat-assistant">${content}</div>`;
                        chatMessages.push({ role: 'assistant', content: content });
                        return;
                    }
                }
                
                // å¦‚æœAPIå¤±è´¥ï¼Œä½¿ç”¨æœ¬åœ°å¤‡ç”¨å›å¤
                console.log('API failed, using local response');
                const localReply = getLocalResponse(message);
                container.innerHTML += `<div class="chat-message chat-assistant">${localReply}</div>`;
                chatMessages.push({ role: 'assistant', content: localReply });
                
            } catch (error) {
                console.error('Chat error:', error);
                document.getElementById('typing').remove();
                // ä½¿ç”¨æœ¬åœ°å›å¤
                const localReply = getLocalResponse(message);
                container.innerHTML += `<div class="chat-message chat-assistant">${localReply}</div>`;
                chatMessages.push({ role: 'assistant', content: localReply });
            } finally {
                btn.disabled = false;
                btn.innerHTML = 'å‘é€';
                container.scrollTop = container.scrollHeight;
            }
        }
        
        // ========== æ–°é—»API ==========
        async function fetchNews() {
            const content = document.getElementById('news-content');
            content.innerHTML = '<div class="loading"><div class="spinner"></div><p>åŠ è½½ä¸­...</p></div>';
            
            try {
                const response = await fetch(`${BASE_URL}/tools/execute?tool_id=newsdata.news.search.v1.b65ccc56`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${API_KEY}` },
                    body: JSON.stringify({ search_id: '', session_id: '', parameters: { q: 'technology AI', language: 'en', size: 6 }, max_response_size: 20480 })
                });
                const data = await response.json();
                
                if (data.success && data.result?.data?.results) {
                    const articles = data.result.data.results;
                    content.innerHTML = articles.map(a => `
                        <div class="news-item" onclick="window.open('${a.link || a.url}', '_blank')">
                            <div class="news-title">${a.title || 'æ— æ ‡é¢˜'}</div>
                            <div class="news-meta">
                                <span>${a.source?.toUpperCase() || 'æœªçŸ¥æ¥æº'}</span>
                                <span>${a.pubDate ? new Date(a.pubDate).toLocaleDateString() : ''}</span>
                            </div>
                        </div>
                    `).join('');
                } else {
                    content.innerHTML = '<p style="text-align: center; color: #ff6b6b;">æ–°é—»åŠ è½½å¤±è´¥</p>';
                }
            } catch (error) {
                console.error('News error:', error);
                content.innerHTML = '<p style="text-align: center; color: #ff6b6b;">æ–°é—»åŠ è½½å¤±è´¥</p>';
            }
        }
        
        // ========== æ±‡ç‡API ==========
        async function fetchRates() {
            const content = document.getElementById('rates-content');
            content.innerHTML = '<div class="loading"><div class="spinner"></div><p>åŠ è½½ä¸­...</p></div>';
            
            try {
                const response = await fetch(`${BASE_URL}/tools/execute?tool_id=frankfurter.exchange_rates.retrieve_latest.v1`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${API_KEY}` },
                    body: JSON.stringify({ search_id: '', session_id: '', parameters: { from: 'USD', to: 'CNY,EUR,JPY,GBP' }, max_response_size: 20480 })
                });
                const data = await response.json();
                
                if (data.success && data.result?.data?.rates) {
                    const rates = data.result.data.rates;
                    const base = data.result.data.amount || 1;
                    content.innerHTML = Object.entries(rates).map(([currency, rate]) => `
                        <div class="rate-item">
                            <div class="rate-pair">
                                <div class="rate-icon">${currency.slice(0, 2)}</div>
                                <div>
                                    <div style="font-weight: bold;">USD/${currency}</div>
                                    <div style="font-size: 0.8em; color: #888;">${base} USD = ${(base * rate).toFixed(2)} ${currency}</div>
                                </div>
                            </div>
                            <div class="rate-value">${rate.toFixed(4)}</div>
                        </div>
                    `).join('');
                } else {
                    content.innerHTML = '<p style="text-align: center; color: #ff6b6b;">æ±‡ç‡åŠ è½½å¤±è´¥</p>';
                }
            } catch (error) {
                console.error('Rates error:', error);
                content.innerHTML = '<p style="text-align: center; color: #ff6b6b;">æ±‡ç‡åŠ è½½å¤±è´¥</p>';
            }
        }
        
        // ========== ä½ç½®API ==========
        async function fetchLocation() {
            const content = document.getElementById('location-content');
            content.innerHTML = '<div class="loading"><div class="spinner"></div><p>åŠ è½½ä¸­...</p></div>';
            
            try {
                const response = await fetch(`${BASE_URL}/tools/execute?tool_id=baidu_map.ip_location.retrieve.v1`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${API_KEY}` },
                    body: JSON.stringify({ search_id: '', session_id: '', parameters: {}, max_response_size: 20480 })
                });
                const data = await response.json();
                
                if (data.success && data.result?.data) {
                    const loc = data.result.data;
                    content.innerHTML = `
                        <div class="location-item"><div class="location-icon"><i class="fas fa-globe"></i></div><div><div class="location-label">å›½å®¶</div><div class="location-value">${loc.country || 'æœªçŸ¥'}</div></div></div>
                        <div class="location-item"><div class="location-icon"><i class="fas fa-map"></i></div><div><div class="location-label">çœä»½</div><div class="location-value">${loc.province || 'æœªçŸ¥'}</div></div></div>
                        <div class="location-item"><div class="location-icon"><i class="fas fa-city"></i></div><div><div class="location-label">åŸå¸‚</div><div class="location-value">${loc.city || 'æœªçŸ¥'}</div></div></div>
                        <div class="location-item"><div class="location-icon"><i class="fas fa-network-wired"></i></div><div><div class="location-label">è¿è¥å•†</div><div class="location-value">${loc.isp || 'æœªçŸ¥'}</div></div></div>
                        <div class="location-item"><div class="location-icon"><i class="fas fa-desktop"></i></div><div><div class="location-label">IPåœ°å€</div><div class="location-value">${loc.ip || 'æœªçŸ¥'}</div></div></div>
                    `;
                } else {
                    content.innerHTML = '<p style="text-align: center; color: #ff6b6b;">ä½ç½®åŠ è½½å¤±è´¥</p>';
                }
            } catch (error) {
                console.error('Location error:', error);
                content.innerHTML = '<p style="text-align: center; color: #ff6b6b;">ä½ç½®åŠ è½½å¤±è´¥</p>';
            }
        }
        
        // ========== å›¾ç‰‡ç”ŸæˆAPI ==========
        async function generateImage() {
            const prompt = document.getElementById('image-prompt').value.trim();
            const size = document.getElementById('image-size').value;
            const result = document.getElementById('image-result');
            
            if (!prompt) {
                alert('è¯·è¾“å…¥å›¾ç‰‡æè¿°');
                return;
            }
            
            result.innerHTML = '<div class="loading"><div class="spinner"></div><p>ç”Ÿæˆä¸­... (å¯èƒ½éœ€è¦10-30ç§’)</p></div>';
            
            try {
                const response = await fetch(`${BASE_URL}/tools/execute?tool_id=bigmodel.images.generation.create.v1`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${API_KEY}` },
                    body: JSON.stringify({ search_id: '', session_id: '', parameters: { model: 'cogview-3', prompt: prompt, size: size.replace('*', 'x') }, max_response_size: 102400 })
                });
                const data = await response.json();
                
                console.log('Image generation response:', data);
                
                // è§£æè¿”å›çš„URL (æ•°æ®ç»“æ„: result.data.data[0].url)
                let imageUrl = null;
                if (data.success && data.result?.data?.data?.[0]?.url) {
                    imageUrl = data.result.data.data[0].url;
                } else if (data.success && data.result?.data?.url) {
                    imageUrl = data.result.data.url;
                } else if (data.success && data.result?.data?.image_url) {
                    imageUrl = data.result.data.image_url;
                }
                
                if (imageUrl) {
                    result.innerHTML = `
                        <div class="image-result">
                            <p style="text-align: center; margin-bottom: 10px; color: #00b894;">âœ… å›¾ç‰‡ç”ŸæˆæˆåŠŸ!</p>
                            <img src="${imageUrl}" class="generated-image" style="max-width: 100%; border-radius: 10px; cursor: pointer; display: block; margin: 0 auto;" onclick="window.open('${imageUrl}', '_blank')">
                            <p style="text-align: center; margin-top: 10px; font-size: 0.8em; color: #888;">ç‚¹å‡»å›¾ç‰‡æŸ¥çœ‹å¤§å›¾</p>
                        </div>
                    `;
                } else {
                    const errorMsg = data.error_message || data.result?.error?.message || 'æœªè¿”å›å›¾ç‰‡URL';
                    result.innerHTML = `
                        <p style="text-align: center; color: #ff6b6b;">âŒ å›¾ç‰‡ç”Ÿæˆå¤±è´¥</p>
                        <p style="text-align: center; font-size: 0.8em; color: #888;">${errorMsg}</p>
                        <p style="text-align: center; font-size: 0.8em; color: #888;">è€—æ—¶: ${data.elapsed_time_ms?.toFixed(0) || 0}ms</p>
                    `;
                }
            } catch (error) {
                console.error('Image error:', error);
                result.innerHTML = `
                    <p style="text-align: center; color: #ff6b6b;">âŒ å›¾ç‰‡ç”Ÿæˆå¤±è´¥</p>
                    <p style="text-align: center; font-size: 0.8em; color: #888;">é”™è¯¯: ${error.message}</p>
                `;
            }
        }
        
        // ========== APIæ¢ç´¢å™¨ ==========
        let currentSearchId = '';
        
        // çƒ­é—¨æœç´¢å…³é”®è¯
        const popularKeywords = [
            { name: 'å¤©æ°”', keyword: 'weather', icon: 'â˜€ï¸' },
            { name: 'è‚¡ç¥¨', keyword: 'stock', icon: 'ğŸ“ˆ' },
            { name: 'AI', keyword: 'AI machine learning', icon: 'ğŸ¤–' },
            { name: 'æ–°é—»', keyword: 'news', icon: 'ğŸ“°' },
            { name: 'ç¿»è¯‘', keyword: 'translation', icon: 'ğŸŒ' },
            { name: 'åœ°å›¾', keyword: 'map location', icon: 'ğŸ—ºï¸' },
            { name: 'å›¾ç‰‡', keyword: 'image generation', icon: 'ğŸ¨' },
            { name: 'é‡‘è', keyword: 'finance forex', icon: 'ğŸ’±' }
        ];
        
        async function searchTools(keyword = null) {
            // å¦‚æœä¼ å…¥äº†å…³é”®è¯ï¼Œç›´æ¥ä½¿ç”¨ï¼›å¦åˆ™ä»è¾“å…¥æ¡†è·å–
            let query = '';
            if (keyword !== null) {
                query = keyword;
                // æ›´æ–°è¾“å…¥æ¡†
                document.getElementById('tool-search').value = keyword;
            } else {
                query = document.getElementById('tool-search').value.trim();
            }
            
            // å¦‚æœè¿˜æ˜¯æ²¡æœ‰è¾“å…¥ï¼Œæ˜¾ç¤ºçƒ­é—¨åˆ†ç±»
            if (!query) {
                const list = document.getElementById('tools-list');
                list.innerHTML = `
                    <div style="text-align: center; padding: 20px;">
                        <p style="font-size: 1.2em; margin-bottom: 20px;">ğŸ” æ¢ç´¢ Qveris å·¥å…·</p>
                        <p style="color: #888; margin-bottom: 20px;">é€‰æ‹©åˆ†ç±»å¼€å§‹æœç´¢:</p>
                        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; max-width: 600px; margin: 0 auto;">
                            ${popularKeywords.map(kw => `
                                <button onclick="searchTools('${kw.keyword}')" style="padding: 15px 10px; background: rgba(102, 126, 234, 0.15); border: 1px solid rgba(102, 126, 234, 0.3); border-radius: 12px; color: #fff; cursor: pointer; transition: all 0.3s ease;">
                                    <div style="font-size: 1.5em; margin-bottom: 5px;">${kw.icon}</div>
                                    <div style="font-size: 0.9em;">${kw.name}</div>
                                </button>
                            `).join('')}
                        </div>
                        <p style="color: #888; margin-top: 20px; font-size: 0.9em;">æˆ–åœ¨ä¸Šæ–¹è¾“å…¥æ¡†ä¸­è¾“å…¥å…³é”®è¯æœç´¢</p>
                    </div>
                `;
                return;
            }
            
            const list = document.getElementById('tools-list');
            list.innerHTML = `
                <div style="text-align: center; padding: 30px;">
                    <div class="spinner" style="margin: 0 auto 15px;"></div>
                    <p>æœç´¢ "${query}" ä¸­...</p>
                </div>
            `;
            
            try {
                const response = await fetch(`${BASE_URL}/search`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${API_KEY}` },
                    body: JSON.stringify({ query: query, limit: 12 })
                });
                const data = await response.json();
                console.log('Search response:', data);
                
                // Qveris APIè¿”å›æ ¼å¼: { total: X, results: [...], search_id: "xxx" }
                // æ³¨æ„: successå­—æ®µå¯èƒ½æ˜¯nullï¼Œä½†resultsæ•°ç»„ä¸€å®šå­˜åœ¨
                if (data.results && data.results.length > 0) {
                    currentSearchId = data.search_id || '';
                    const total = data.total || data.results.length;
                    
                    list.innerHTML = `
                        <div style="margin-bottom: 15px; padding: 10px 15px; background: rgba(0, 184, 148, 0.1); border-radius: 10px; display: flex; justify-content: space-between; align-items: center;">
                            <span style="color: #00b894;">
                                âœ… æ‰¾åˆ° <strong style="font-size: 1.2em;">${total}</strong> ä¸ªç›¸å…³å·¥å…·
                            </span>
                            <span style="color: #888; font-size: 0.85em;">
                                æœç´¢: "${query}"
                            </span>
                        </div>
                        ${data.results.map(t => {
                            const params = t.examples?.sample_parameters || {};
                            const paramStr = JSON.stringify(params).replace(/"/g, '&quot;');
                            return `
                                <div class="tool-item" onclick='executeTool("${t.tool_id}", ${paramStr})'>
                                    <div class="tool-name">
                                        <i class="fas fa-cube"></i> 
                                        ${t.name || 'æœªçŸ¥å·¥å…·'}
                                    </div>
                                    <div class="tool-desc">
                                        ${(t.description || 'æ— æè¿°').replace(/<[^>]*>/g, '').slice(0, 250)}...
                                    </div>
                                    <div class="tool-meta">
                                        <span title="æä¾›å•†"><i class="fas fa-building"></i> ${(t.provider_description || '').split('.')[0] || 'æœªçŸ¥'}</span>
                                        ${t.stats ? `<span title="å¹³å‡å“åº”æ—¶é—´"><i class="fas fa-bolt"></i> ${t.stats.avg_execution_time_ms?.toFixed(0) || 0}ms</span>` : ''}
                                        ${t.stats !== undefined ? `<span title="æˆåŠŸç‡">ğŸ“Š ${(t.stats.success_rate * 100).toFixed(0)}%</span>` : ''}
                                    </div>
                                </div>
                            `;
                        }).join('')}
                        <div style="text-align: center; margin-top: 20px; padding: 15px; background: rgba(102, 126, 234, 0.1); border-radius: 10px;">
                            <p style="color: #888; font-size: 0.9em; margin-bottom: 10px;">ğŸ’¡ ç‚¹å‡»å·¥å…·æŸ¥çœ‹è¯¦æƒ…å¹¶æ‰§è¡Œ</p>
                            <p style="color: #666; font-size: 0.8em;">å·¥å…·æ¥è‡ª Qveris å¹³å°ï¼Œå…±æ”¶å½• 1000+ API å·¥å…·</p>
                        </div>
                    `;
                } else {
                    // å¦‚æœæ²¡æœ‰æœç´¢ç»“æœï¼Œæ˜¾ç¤ºå»ºè®®
                    list.innerHTML = `
                        <div style="text-align: center; padding: 20px;">
                            <p style="font-size: 2em; margin-bottom: 10px;">ğŸ”</p>
                            <p style="color: #f39c12; font-size: 1.1em; margin-bottom: 15px;">
                                æœªæ‰¾åˆ° "${query}" ç›¸å…³å·¥å…·
                            </p>
                            <p style="color: #888; margin-bottom: 20px;">è¯•è¯•è¿™äº›çƒ­é—¨æœç´¢:</p>
                            <div style="display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; margin-bottom: 25px;">
                                ${popularKeywords.map(kw => `
                                    <button onclick="searchTools('${kw.keyword}')" style="padding: 10px 18px; background: rgba(102, 126, 234, 0.2); border: 1px solid rgba(102, 126, 234, 0.5); border-radius: 20px; color: #fff; cursor: pointer; transition: all 0.3s ease; font-size: 0.9em;">
                                        ${kw.icon} ${kw.name}
                                    </button>
                                `).join('')}
                            </div>
                            <div style="border-top: 1px solid rgba(255,255,255,0.1); padding-top: 20px;">
                                <p style="color: #888; margin-bottom: 10px;">ğŸ’¡ æœç´¢æç¤º:</p>
                                <ul style="text-align: left; color: #888; font-size: 0.85em; max-width: 400px; margin: 0 auto; padding-left: 20px;">
                                    <li>ä½¿ç”¨æ›´é€šç”¨çš„å…³é”®è¯</li>
                                    <li>å°è¯•è‹±æ–‡å…³é”®è¯</li>
                                    <li>ä½¿ç”¨ç±»åˆ«åç§°ï¼Œå¦‚ "weather", "finance"</li>
                                </ul>
                            </div>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Search error:', error);
                list.innerHTML = `
                    <div style="text-align: center; padding: 30px;">
                        <p style="color: #ff6b6b; font-size: 2em; margin-bottom: 15px;">âŒ</p>
                        <p style="color: #ff6b6b; font-size: 1.1em;">æœç´¢å¤±è´¥</p>
                        <p style="color: #888; margin: 15px 0;">${error.message}</p>
                        <button onclick="searchTools('popular')" style="padding: 10px 20px; background: #667eea; border: none; color: #fff; border-radius: 8px; cursor: pointer;">
                            æŸ¥çœ‹çƒ­é—¨å·¥å…·
                        </button>
                    </div>
                `;
            }
            } catch (error) {
                console.error('Search error:', error);
                list.innerHTML = `
                    <p style="text-align: center; color: #ff6b6b;">âŒ æœç´¢å¤±è´¥</p>
                    <p style="text-align: center; font-size: 0.85em; color: #888;">${error.message}</p>
                    <button onclick="searchTools('popular')" style="margin-top: 15px; padding: 10px 20px; background: #667eea; border: none; color: #fff; border-radius: 8px; cursor: pointer;">
                        æ˜¾ç¤ºçƒ­é—¨å·¥å…·
                    </button>
                `;
            }
        }
        
        async function executeTool(toolId, params) {
            const modal = document.getElementById('result-modal');
            const body = document.getElementById('modal-body');
            modal.classList.add('show');
            body.innerHTML = `
                <div style="text-align: center; padding: 40px;">
                    <div class="spinner" style="margin: 0 auto 15px;"></div>
                    <p>æ­£åœ¨æ‰§è¡Œå·¥å…·...</p>
                    <p style="font-size: 0.85em; color: #888; margin-top: 10px;">
                        Tool ID: ${toolId}
                    </p>
                </div>
            `;
            
            try {
                console.log('Executing tool:', toolId, params);
                const response = await fetch(`${BASE_URL}/tools/execute?tool_id=${toolId}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${API_KEY}` },
                    body: JSON.stringify({ 
                        search_id: currentSearchId, 
                        session_id: '', 
                        parameters: params, 
                        max_response_size: 102400 
                    })
                });
                const data = await response.json();
                console.log('Execute response:', data);
                
                // è§£æç»“æœ
                let resultContent = '';
                let success = false;
                
                if (data.success !== false && data.result) {
                    // æˆåŠŸæƒ…å†µ
                    success = true;
                    const content = data.result.data || data.result;
                    
                    // ç¾åŒ–JSONè¾“å‡º
                    if (typeof content === 'object') {
                        resultContent = `<pre style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px; overflow-x: auto; font-size: 0.8em; text-align: left;">${JSON.stringify(content, null, 2)}</pre>`;
                    } else {
                        resultContent = `<p>${content}</p>`;
                    }
                } else {
                    // å¤±è´¥æƒ…å†µ
                    success = false;
                    resultContent = `<p style="color: #ff6b6b;">${data.error_message || data.result?.error?.message || 'æ‰§è¡Œå¤±è´¥'}</p>`;
                }
                
                body.innerHTML = `
                    <div style="margin-bottom: 20px;">
                        <h4 style="margin-bottom: 10px;">
                            <i class="fas ${success ? 'fa-check-circle' : 'fa-times-circle'}" style="color: ${success ? '#00b894' : '#ff6b6b'}; margin-right: 8px;"></i>
                            ${success ? 'æ‰§è¡ŒæˆåŠŸ' : 'æ‰§è¡Œå¤±è´¥'}
                        </h4>
                        <p style="font-size: 0.85em; color: #888;">
                            Tool: <code style="background: rgba(102, 126, 234, 0.2); padding: 2px 6px; border-radius: 4px;">${toolId}</code>
                        </p>
                        <p style="font-size: 0.85em; color: #888;">
                            è€—æ—¶: ${data.elapsed_time_ms ? (data.elapsed_time_ms / 1000).toFixed(2) + 'ç§’' : 'æœªçŸ¥'}
                        </p>
                    </div>
                    ${resultContent}
                    <button onclick="closeModal()" style="margin-top: 20px; padding: 10px 25px; background: #667eea; border: none; color: #fff; border-radius: 8px; cursor: pointer;">
                        å…³é—­
                    </button>
                `;
            } catch (error) {
                console.error('Execute error:', error);
                body.innerHTML = `
                    <p style="color: #ff6b6b; font-size: 1.1em; margin-bottom: 15px;">
                        <i class="fas fa-exclamation-triangle"></i> æ‰§è¡Œå‡ºé”™
                    </p>
                    <p style="color: #888;">${error.message}</p>
                    <button onclick="closeModal()" style="margin-top: 20px; padding: 10px 25px; background: #667eea; border: none; color: #fff; border-radius: 8px; cursor: pointer;">
                        å…³é—­
                    </button>
                `;
            }
        }
        
        function closeModal() {
            document.getElementById('result-modal').classList.remove('show');
        }
        
        // åˆå§‹åŠ è½½
        window.onload = function() {
            fetchWeather();
            fetchStock();
            fetchNews();
            fetchRates();
            fetchLocation();
            searchTools();
        };
    </script>
</body>
</html>
