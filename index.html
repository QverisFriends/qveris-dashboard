<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qveris æ™ºèƒ½ä»ªè¡¨ç›˜</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
            min-height: 100vh;
            color: #fff;
            padding: 20px;
        }
        .container { max-width: 1400px; margin: 0 auto; }
        .header { text-align: center; padding: 30px 0; }
        .header h1 { font-size: 2.5em; background: linear-gradient(90deg, #667eea, #764ba2); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .clock { font-size: 1.8em; color: #667eea; margin-bottom: 10px; }
        .date { color: #aaa; font-size: 1.1em; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(380px, 1fr)); gap: 20px; padding: 20px 0; }
        .card {
            background: rgba(255,255,255,0.08);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px;
            border: 1px solid rgba(255,255,255,0.1);
            transition: all 0.3s ease;
        }
        .card:hover { transform: translateY(-5px); box-shadow: 0 10px 40px rgba(102,126,234,0.2); }
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .card-header h2 { font-size: 1.2em; display: flex; align-items: center; gap: 10px; }
        .card-header i { color: #667eea; }
        .refresh-btn { background: rgba(255,255,255,0.1); border: none; color: #fff; padding: 8px 12px; border-radius: 8px; cursor: pointer; transition: all 0.3s ease; }
        .refresh-btn:hover { background: rgba(102,126,234,0.3); }
        .loading { text-align: center; padding: 40px; color: #888; }
        .spinner { width: 40px; height: 40px; border: 3px solid rgba(255,255,255,0.1); border-top-color: #667eea; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 15px; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .api-badge { font-size: 0.7em; background: rgba(102,126,234,0.3); padding: 2px 8px; border-radius: 10px; margin-left: 8px; }
        
        /* å¤©æ°”æ ·å¼ */
        .weather-location { text-align: center; font-size: 1.3em; margin-bottom: 10px; }
        .weather-main { text-align: center; font-size: 4em; margin: 15px 0; }
        .weather-desc { text-align: center; font-size: 1.2em; color: #ddd; margin-bottom: 20px; }
        .weather-details { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
        .weather-detail { background: rgba(255,255,255,0.05); padding: 12px; border-radius: 10px; text-align: center; }
        .weather-detail-label { font-size: 0.85em; color: #aaa; }
        .weather-detail-value { font-size: 1.2em; font-weight: bold; }
        
        /* è‚¡ç¥¨æ ·å¼ */
        .stock-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .stock-name { font-size: 1.4em; font-weight: bold; }
        .stock-price { font-size: 2.2em; font-weight: bold; color: #667eea; }
        .stock-change { font-size: 1.1em; margin-left: 10px; }
        .stock-details { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
        .stock-detail { background: rgba(255,255,255,0.05); padding: 10px; border-radius: 8px; text-align: center; }
        .stock-detail-label { font-size: 0.8em; color: #aaa; }
        .stock-detail-value { font-size: 1em; font-weight: bold; margin-top: 3px; }
        
        /* æ–°é—»æ ·å¼ */
        .news-item { background: rgba(255,255,255,0.03); padding: 12px; margin-bottom: 10px; border-radius: 10px; border-left: 3px solid #667eea; cursor: pointer; transition: all 0.3s ease; }
        .news-item:hover { background: rgba(102,126,234,0.1); }
        .news-title { font-weight: bold; margin-bottom: 5px; font-size: 0.95em; }
        .news-meta { font-size: 0.75em; color: #888; display: flex; justify-content: space-between; }
        
        /* æ±‡ç‡æ ·å¼ */
        .rate-item { display: flex; justify-content: space-between; align-items: center; padding: 12px; background: rgba(255,255,255,0.05); border-radius: 10px; margin-bottom: 8px; }
        .rate-pair { display: flex; align-items: center; gap: 10px; }
        .rate-icon { width: 35px; height: 35px; border-radius: 50%; background: linear-gradient(135deg, #667eea, #764ba2); display: flex; align-items: center; justify-content: center; font-size: 0.8em; font-weight: bold; }
        .rate-value { font-weight: bold; color: #667eea; font-size: 1.1em; }
        
        /* ä½ç½®æ ·å¼ */
        .location-item { display: flex; align-items: center; gap: 12px; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 10px; margin-bottom: 8px; }
        .location-icon { width: 40px; height: 40px; background: rgba(102,126,234,0.2); border-radius: 10px; display: flex; align-items: center; justify-content: center; color: #667eea; }
        .location-label { font-size: 0.8em; color: #aaa; }
        .location-value { font-weight: bold; font-size: 1em; }
        
        /* AIå¯¹è¯æ ·å¼ */
        .chat-container { height: 280px; overflow-y: auto; padding: 10px; background: rgba(0,0,0,0.2); border-radius: 10px; margin-bottom: 10px; }
        .chat-message { margin-bottom: 10px; padding: 10px 15px; border-radius: 15px; max-width: 85%; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .chat-user { background: linear-gradient(135deg, #667eea, #764ba2); margin-left: auto; border-bottom-right-radius: 5px; }
        .chat-assistant { background: rgba(255,255,255,0.1); margin-right: auto; border-bottom-left-radius: 5px; }
        .chat-input-container { display: flex; gap: 10px; }
        .chat-input { flex: 1; padding: 12px 15px; border-radius: 25px; border: 1px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.05); color: #fff; font-size: 1em; outline: none; }
        .chat-input:focus { border-color: #667eea; }
        .chat-btn { background: linear-gradient(135deg, #667eea, #764ba2); border: none; color: #fff; padding: 12px 25px; border-radius: 25px; cursor: pointer; font-size: 1em; transition: all 0.3s ease; }
        .chat-btn:hover { transform: scale(1.05); box-shadow: 0 5px 20px rgba(102,126,234,0.4); }
        .chat-btn:disabled { opacity: 0.5; cursor: not-allowed; }
        
        /* å›¾ç‰‡ç”Ÿæˆæ ·å¼ */
        .image-prompt { width: 100%; padding: 12px; border-radius: 10px; border: 1px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.05); color: #fff; font-size: 1em; margin-bottom: 10px; resize: vertical; min-height: 80px; }
        .image-select { width: 100%; padding: 12px; border-radius: 10px; border: 1px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.05); color: #fff; font-size: 1em; margin-bottom: 10px; }
        .image-result { text-align: center; margin-top: 15px; }
        .generated-image { max-width: 100%; border-radius: 10px; cursor: pointer; }
        
        /* APIæ¢ç´¢å™¨æ ·å¼ */
        .search-input { width: 100%; padding: 12px 15px; border-radius: 10px; border: 1px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.05); color: #fff; font-size: 1em; outline: none; margin-bottom: 10px; }
        .search-input:focus { border-color: #667eea; }
        .quick-buttons { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 15px; }
        .quick-btn { padding: 8px 15px; background: rgba(102,126,234,0.2); border: 1px solid rgba(102,126,234,0.5); border-radius: 20px; color: #fff; cursor: pointer; font-size: 0.85em; transition: all 0.3s ease; }
        .quick-btn:hover { background: rgba(102,126,234,0.4); }
        .tool-item { background: rgba(255,255,255,0.03); padding: 15px; border-radius: 10px; margin-bottom: 10px; border-left: 3px solid #667eea; cursor: pointer; transition: all 0.3s ease; }
        .tool-item:hover { background: rgba(102,126,234,0.1); }
        .tool-name { font-weight: bold; margin-bottom: 5px; display: flex; align-items: center; gap: 8px; }
        .tool-desc { font-size: 0.85em; color: #aaa; margin-bottom: 8px; }
        .tool-meta { display: flex; gap: 15px; font-size: 0.75em; color: #888; }
        .tools-list { max-height: 350px; overflow-y: auto; }
        
        /* æ¨¡æ€æ¡†æ ·å¼ */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; justify-content: center; align-items: center; }
        .modal.show { display: flex; }
        .modal-content { background: #1a1a2e; border-radius: 20px; padding: 25px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .modal-close { background: none; border: none; color: #fff; font-size: 1.5em; cursor: pointer; }
        .modal-body pre { background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px; overflow-x: auto; font-size: 0.85em; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="clock" id="clock">00:00:00</div>
            <div class="date" id="date">åŠ è½½ä¸­...</div>
            <h1>ğŸŒ Qveris æ™ºèƒ½ä»ªè¡¨ç›˜</h1>
            <p style="color: #888; margin-top: 10px;">åŸºäº Qveris API çš„å¤šåŠŸèƒ½æ™ºèƒ½åŠ©æ‰‹</p>
        </div>
        
        <div class="grid">
            <!-- å¤©æ°”å¡ç‰‡ -->
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-cloud-sun"></i>
                    <h2>å¤©æ°”é¢„æŠ¥ <span class="api-badge">å¤©æ°”API</span></h2>
                    <button class="refresh-btn" onclick="fetchWeather()"><i class="fas fa-sync-alt"></i></button>
                </div>
                <div id="weather-content">
                    <div class="loading"><div class="spinner"></div><p>åŠ è½½ä¸­...</p></div>
                </div>
            </div>
            
            <!-- è‚¡ç¥¨å¡ç‰‡ -->
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-chart-line"></i>
                    <h2>è‚¡ç¥¨è¡Œæƒ… <span class="api-badge">NVDA</span></h2>
                    <button class="refresh-btn" onclick="fetchStock()"><i class="fas fa-sync-alt"></i></button>
                </div>
                <div id="stock-content">
                    <div class="loading"><div class="spinner"></div><p>åŠ è½½ä¸­...</p></div>
                </div>
            </div>
            
            <!-- AIå¯¹è¯å¡ç‰‡ -->
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-robot"></i>
                    <h2>AI æ™ºèƒ½åŠ©æ‰‹ <span class="api-badge">Qveris</span></h2>
                </div>
                <div class="chat-container" id="chat-container">
                    <div class="chat-message chat-assistant">ä½ å¥½ï¼æˆ‘æ˜¯Qveris AIåŠ©æ‰‹ã€‚è¾“å…¥ä½ çš„é—®é¢˜ï¼Œæˆ‘ä¼šå°½åŠ›å›ç­”ï¼</div>
                </div>
                <div class="chat-input-container">
                    <input type="text" class="chat-input" id="chat-input" placeholder="è¾“å…¥æ¶ˆæ¯..." onkeypress="if(event.key==='Enter')sendMessage()">
                    <button class="chat-btn" onclick="sendMessage()" id="chat-btn">å‘é€</button>
                </div>
            </div>
            
            <!-- ç§‘æŠ€æ–°é—»å¡ç‰‡ -->
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-newspaper"></i>
                    <h2>ç§‘æŠ€æ–°é—» <span class="api-badge">NewsData</span></h2>
                    <button class="refresh-btn" onclick="fetchNews()"><i class="fas fa-sync-alt"></i></button>
                </div>
                <div id="news-content" style="max-height: 300px; overflow-y: auto;">
                    <div class="loading"><div class="spinner"></div><p>åŠ è½½ä¸­...</p></div>
                </div>
            </div>
            
            <!-- æ±‡ç‡å¡ç‰‡ -->
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-money-bill-wave"></i>
                    <h2>æ±‡ç‡è½¬æ¢ <span class="api-badge">Frankfurter</span></h2>
                    <button class="refresh-btn" onclick="fetchRates()"><i class="fas fa-sync-alt"></i></button>
                </div>
                <div id="rates-content">
                    <div class="loading"><div class="spinner"></div><p>åŠ è½½ä¸­...</p></div>
                </div>
            </div>
            
            <!-- ä½ç½®å¡ç‰‡ -->
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-map-marker-alt"></i>
                    <h2>ä½ç½®æŸ¥è¯¢ <span class="api-badge">IPå®šä½</span></h2>
                    <button class="refresh-btn" onclick="fetchLocation()"><i class="fas fa-sync-alt"></i></button>
                </div>
                <div id="location-content">
                    <div class="loading"><div class="spinner"></div><p>åŠ è½½ä¸­...</p></div>
                </div>
            </div>
            
            <!-- AIå›¾ç‰‡ç”Ÿæˆå¡ç‰‡ -->
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-palette"></i>
                    <h2>AI å›¾ç‰‡ç”Ÿæˆ <span class="api-badge">æ™ºè°±AI</span></h2>
                </div>
                <div style="padding: 10px;">
                    <textarea id="image-prompt" class="image-prompt" placeholder="æè¿°ä½ æƒ³è¦ç”Ÿæˆçš„å›¾ç‰‡ï¼Œä¾‹å¦‚ï¼šä¸€åªæ©™è‰²çš„å°çŒ«åœ¨è‰åœ°ä¸Šç©è€..."></textarea>
                    <select id="image-size" class="image-select">
                        <option value="512x512">512x512 (å¿«é€Ÿ)</option>
                        <option value="768x768">768x768 (ä¸­ç­‰)</option>
                        <option value="1024x1024">1024x1024 (é«˜æ¸…)</option>
                    </select>
                    <button class="chat-btn" style="width: 100%;" onclick="generateImage()">ç”Ÿæˆå›¾ç‰‡</button>
                    <div id="image-result"></div>
                </div>
            </div>
            
            <!-- APIæ¢ç´¢å™¨å¡ç‰‡ -->
            <div class="card" style="grid-column: span 2;">
                <div class="card-header">
                    <i class="fas fa-search"></i>
                    <h2>Qveris API æ¢ç´¢å™¨ <span class="api-badge">1000+å·¥å…·</span></h2>
                </div>
                <input type="text" class="search-input" id="tool-search" placeholder="ğŸ” æœç´¢APIå·¥å…· (ä¾‹å¦‚: weather, stock, AI, image...)" onkeypress="if(event.key==='Enter')searchTools()">
                <div class="quick-buttons">
                    <button class="quick-btn" onclick="searchTools('weather')">â˜€ï¸ å¤©æ°”</button>
                    <button class="quick-btn" onclick="searchTools('stock')">ğŸ“ˆ è‚¡ç¥¨</button>
                    <button class="quick-btn" onclick="searchTools('AI')">ğŸ¤– AI</button>
                    <button class="quick-btn" onclick="searchTools('news')">ğŸ“° æ–°é—»</button>
                    <button class="quick-btn" onclick="searchTools('image')">ğŸ¨ å›¾ç‰‡</button>
                    <button class="quick-btn" onclick="searchTools('translation')">ğŸŒ ç¿»è¯‘</button>
                    <button class="quick-btn" onclick="searchTools('map')">ğŸ—ºï¸ åœ°å›¾</button>
                    <button class="quick-btn" onclick="searchTools('finance')">ğŸ’± é‡‘è</button>
                </div>
                <button class="chat-btn" style="margin-bottom: 15px;" onclick="searchTools()">ğŸ” æœç´¢</button>
                <div class="tools-list" id="tools-list">
                    <div class="loading"><div class="spinner"></div><p>ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®æˆ–è¾“å…¥å…³é”®è¯æœç´¢å·¥å…·...</p></div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- æ¨¡æ€æ¡† -->
    <div class="modal" id="result-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>å·¥å…·æ‰§è¡Œç»“æœ</h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body" id="modal-body"></div>
        </div>
    </div>
    
    <script>
        // ========== é…ç½® ==========
        const API_KEY = 'sk-VeJWtelcfNcqgm6H-V_TfkWX4Or2IyskjXqBvBszQ-k';
        const BASE_URL = 'https://qveris.ai/api/v1';
        
        // ========== åˆå§‹åŒ– ==========
        function updateClock() {
            const now = new Date();
            document.getElementById('clock').textContent = now.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
            document.getElementById('date').textContent = now.toLocaleDateString('zh-CN', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
        }
        setInterval(updateClock, 1000);
        updateClock();
        
        window.onload = function() {
            fetchWeather();
            fetchStock();
            fetchNews();
            fetchRates();
            fetchLocation();
        };
        
        // ========== å¤©æ°”API ==========
        async function fetchWeather() {
            const content = document.getElementById('weather-content');
            content.innerHTML = '<div class="loading"><div class="spinner"></div><p>åŠ è½½ä¸­...</p></div>';
            
            try {
                const response = await fetch(`${BASE_URL}/tools/execute?tool_id=weather_api.current.retrieve.v1.dca6c0f0`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${API_KEY}` },
                    body: JSON.stringify({ search_id: '', session_id: '', parameters: { q: 'Beijing', aqi: 'yes' }, max_response_size: 20480 })
                });
                const data = await response.json();
                
                if (data.success && data.result?.data) {
                    const w = data.result.data;
                    const c = w.current;
                    const aqi = c.air_quality?.['us-epa-index'] || '-';
                    const temp = Math.round(c.temp_c);
                    
                    content.innerHTML = `
                        <div class="weather-location"><i class="fas fa-map-marker-alt"></i> ${w.location?.name || 'åŒ—äº¬'}</div>
                        <div class="weather-main">${getWeatherIcon(c.condition?.text)}</div>
                        <div class="weather-desc">${c.condition?.text || 'æœªçŸ¥'}</div>
                        <div class="weather-details">
                            <div class="weather-detail"><div class="weather-detail-label">æ¸©åº¦</div><div class="weather-detail-value">${temp}Â°C</div></div>
                            <div class="weather-detail"><div class="weather-detail-label">æ¹¿åº¦</div><div class="weather-detail-value">${c.humidity}%</div></div>
                            <div class="weather-detail"><div class="weather-detail-label">é£é€Ÿ</div><div class="weather-detail-value">${c.wind_kph} km/h</div></div>
                            <div class="weather-detail"><div class="weather-detail-label">ç©ºæ°”è´¨é‡</div><div class="weather-detail-value">${aqi}</div></div>
                        </div>
                    `;
                } else {
                    content.innerHTML = '<p style="text-align: center; color: #ff6b6b;">å¤©æ°”åŠ è½½å¤±è´¥</p>';
                }
            } catch (error) {
                console.error('Weather error:', error);
                content.innerHTML = '<p style="text-align: center; color: #ff6b6b;">å¤©æ°”åŠ è½½å¤±è´¥</p>';
            }
        }
        
        function getWeatherIcon(condition) {
            const icons = {
                'Sunny': '<i class="fas fa-sun" style="color: #f1c40f;"></i>',
                'Clear': '<i class="fas fa-moon" style="color: #9b59b6;"></i>',
                'Cloudy': '<i class="fas fa-cloud" style="color: #3498db;"></i>',
                'Rain': '<i class="fas fa-cloud-rain" style="color: #2980b9;"></i>',
                'Snow': '<i class="fas fa-snowflake" style="color: #ecf0f1;"></i>'
            };
            return icons[condition] || '<i class="fas fa-cloud-sun"></i>';
        }
        
        // ========== è‚¡ç¥¨API ==========
        async function fetchStock() {
            const content = document.getElementById('stock-content');
            content.innerHTML = '<div class="loading"><div class="spinner"></div><p>åŠ è½½ä¸­...</p></div>';
            
            try {
                const response = await fetch(`${BASE_URL}/tools/execute?tool_id=financial_modeling_prep.stock.quote.retrieve.v1.822497ca`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${API_KEY}` },
                    body: JSON.stringify({ search_id: '', session_id: '', parameters: { symbol: 'NVDA' }, max_response_size: 20480 })
                });
                const data = await response.json();
                
                if (data.success && data.result?.data?.[0]) {
                    const s = data.result.data[0];
                    const change = s.change || 0;
                    const pct = (s.changePercentage || 0) * 100;
                    const isUp = change >= 0;
                    
                    content.innerHTML = `
                        <div class="stock-header">
                            <div>
                                <div class="stock-name">${s.symbol} - ${s.name || 'NVIDIA'}</div>
                                <div><span class="stock-price">$${s.price?.toFixed(2) || '--'}</span>
                                <span class="stock-change" style="color: ${isUp ? '#00b894' : '#ff6b6b'}">${isUp ? '+' : ''}${change.toFixed(2)} (${isUp ? '+' : ''}${pct.toFixed(2)}%)</span></div>
                            </div>
                            <i class="fas fa-${isUp ? 'caret-up' : 'caret-down'}" style="font-size: 2em; color: ${isUp ? '#00b894' : '#ff6b6b'}"></i>
                        </div>
                        <div class="stock-details">
                            <div class="stock-detail"><div class="stock-detail-label">å¼€ç›˜</div><div class="stock-detail-value">$${s.open?.toFixed(2) || '-'}</div></div>
                            <div class="stock-detail"><div class="stock-detail-label">æœ€é«˜</div><div class="stock-detail-value">$${s.dayHigh?.toFixed(2) || '-'}</div></div>
                            <div class="stock-detail"><div class="stock-detail-label">æœ€ä½</div><div class="stock-detail-value">$${s.dayLow?.toFixed(2) || '-'}</div></div>
                            <div class="stock-detail"><div class="stock-detail-label">æˆäº¤é‡</div><div class="stock-detail-value">${(s.volume / 1000000).toFixed(1)}M</div></div>
                        </div>
                    `;
                } else {
                    content.innerHTML = '<p style="text-align: center; color: #ff6b6b;">è‚¡ç¥¨åŠ è½½å¤±è´¥</p>';
                }
            } catch (error) {
                console.error('Stock error:', error);
                content.innerHTML = '<p style="text-align: center; color: #ff6b6b;">è‚¡ç¥¨åŠ è½½å¤±è´¥</p>';
            }
        }
        
        // ========== AIå¯¹è¯ ==========
        let chatMessages = [];
        
        function getLocalResponse(message) {
            const lower = message.toLowerCase();
            if (lower.includes('å¤©æ°”')) return "æŸ¥çœ‹ä¸Šæ–¹çš„å¤©æ°”å¡ç‰‡å¯ä»¥è·å–å®æ—¶å¤©æ°”ä¿¡æ¯ï¼";
            if (lower.includes('è‚¡ç¥¨')) return "æŸ¥çœ‹ä¸Šæ–¹çš„è‚¡ç¥¨å¡ç‰‡å¯ä»¥è·å–NVDAå®æ—¶è¡Œæƒ…ï¼";
            if (lower.includes('æ–°é—»')) return "ç§‘æŠ€æ–°é—»æ¯5åˆ†é’Ÿè‡ªåŠ¨æ›´æ–°ä¸€æ¬¡ã€‚";
            if (lower.includes('ä½ å¥½') || lower.includes('hi')) return "ä½ å¥½ï¼æœ‰ä»€ä¹ˆå¯ä»¥å¸®åŠ©ä½ çš„å—ï¼Ÿ";
            if (lower.includes('å¸®åŠ©')) return "æˆ‘å¯ä»¥å›ç­”ç®€å•é—®é¢˜ã€‚å…¶ä»–åŠŸèƒ½è¯·æŸ¥çœ‹å„ä¸ªå¡ç‰‡ã€‚";
            return "è¿™æ˜¯ä¸€ä¸ªåŸºäºQveris APIçš„æ™ºèƒ½ä»ªè¡¨ç›˜ï¼Œæ”¯æŒå¤©æ°”ã€è‚¡ç¥¨ã€æ–°é—»ã€æ±‡ç‡ã€ä½ç½®æŸ¥è¯¢ã€AIå›¾ç‰‡ç”Ÿæˆç­‰åŠŸèƒ½ï¼";
        }
        
        async function sendMessage() {
            const input = document.getElementById('chat-input');
            const btn = document.getElementById('chat-btn');
            const container = document.getElementById('chat-container');
            const message = input.value.trim();
            
            if (!message) return;
            
            input.value = '';
            container.innerHTML += `<div class="chat-message chat-user">${message}</div>`;
            chatMessages.push({ role: 'user', content: message });
            
            btn.disabled = true;
            btn.innerHTML = 'æ€è€ƒä¸­...';
            container.innerHTML += `<div class="chat-message chat-assistant" id="typing"><i class="fas fa-ellipsis-h"></i> æ€è€ƒä¸­...</div>`;
            container.scrollTop = container.scrollHeight;
            
            try {
                const response = await fetch(`${BASE_URL}/tools/execute?tool_id=groq.groqapi.chat.completions.create.v1.19d0750a`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${API_KEY}` },
                    body: JSON.stringify({ search_id: '', session_id: '', parameters: { model: 'meta-llama/llama-4-maverick-17b-128e-instruct', messages: chatMessages, max_tokens: 200 }, max_response_size: 20480 })
                });
                const data = await response.json();
                document.getElementById('typing').remove();
                
                if (data.success && data.result?.data?.choices?.length > 0) {
                    const content = data.result.data.choices[0]?.message?.content || '';
                    if (content) {
                        container.innerHTML += `<div class="chat-message chat-assistant">${content}</div>`;
                        chatMessages.push({ role: 'assistant', content: content });
                        return;
                    }
                }
                
                // ä½¿ç”¨æœ¬åœ°å›å¤
                const localReply = getLocalResponse(message);
                container.innerHTML += `<div class="chat-message chat-assistant">${localReply}</div>`;
                chatMessages.push({ role: 'assistant', content: localReply });
                
            } catch (error) {
                console.error('Chat error:', error);
                document.getElementById('typing').remove();
                const localReply = getLocalResponse(message);
                container.innerHTML += `<div class="chat-message chat-assistant">${localReply}</div>`;
                chatMessages.push({ role: 'assistant', content: localReply });
            } finally {
                btn.disabled = false;
                btn.innerHTML = 'å‘é€';
                container.scrollTop = container.scrollHeight;
            }
        }
        
        // ========== æ–°é—»API ==========
        async function fetchNews() {
            const content = document.getElementById('news-content');
            content.innerHTML = '<div class="loading"><div class="spinner"></div><p>åŠ è½½ä¸­...</p></div>';
            
            try {
                const response = await fetch(`${BASE_URL}/tools/execute?tool_id=newsdata.news.search.v1.b65ccc56`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${API_KEY}` },
                    body: JSON.stringify({ search_id: '', session_id: '', parameters: { q: 'technology AI', language: 'en', size: 6 }, max_response_size: 20480 })
                });
                const data = await response.json();
                
                if (data.success && data.result?.data?.results) {
                    const articles = data.result.data.results;
                    content.innerHTML = articles.map(a => `
                        <div class="news-item" onclick="window.open('${a.link || a.url}', '_blank')">
                            <div class="news-title">${a.title || 'æ— æ ‡é¢˜'}</div>
                            <div class="news-meta">
                                <span>${a.source?.toUpperCase() || 'æœªçŸ¥æ¥æº'}</span>
                                <span>${a.pubDate ? new Date(a.pubDate).toLocaleDateString() : ''}</span>
                            </div>
                        </div>
                    `).join('');
                } else {
                    content.innerHTML = '<p style="text-align: center; color: #ff6b6b;">æ–°é—»åŠ è½½å¤±è´¥</p>';
                }
            } catch (error) {
                console.error('News error:', error);
                content.innerHTML = '<p style="text-align: center; color: #ff6b6b;">æ–°é—»åŠ è½½å¤±è´¥</p>';
            }
        }
        
        // ========== æ±‡ç‡API ==========
        async function fetchRates() {
            const content = document.getElementById('rates-content');
            content.innerHTML = '<div class="loading"><div class="spinner"></div><p>åŠ è½½ä¸­...</p></div>';
            
            try {
                const response = await fetch(`${BASE_URL}/tools/execute?tool_id=frankfurter.exchange_rates.retrieve_latest.v1`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${API_KEY}` },
                    body: JSON.stringify({ search_id: '', session_id: '', parameters: { from: 'USD', to: 'CNY,EUR,JPY,GBP' }, max_response_size: 20480 })
                });
                const data = await response.json();
                
                if (data.success && data.result?.data?.rates) {
                    const rates = data.result.data.rates;
                    content.innerHTML = Object.entries(rates).map(([currency, rate]) => `
                        <div class="rate-item">
                            <div class="rate-pair">
                                <div class="rate-icon">${currency.slice(0, 2)}</div>
                                <div>
                                    <div style="font-weight: bold;">USD/${currency}</div>
                                    <div style="font-size: 0.8em; color: #888;">1 USD = ${rate.toFixed(4)} ${currency}</div>
                                </div>
                            </div>
                            <div class="rate-value">${rate.toFixed(4)}</div>
                        </div>
                    `).join('');
                } else {
                    content.innerHTML = '<p style="text-align: center; color: #ff6b6b;">æ±‡ç‡åŠ è½½å¤±è´¥</p>';
                }
            } catch (error) {
                console.error('Rates error:', error);
                content.innerHTML = '<p style="text-align: center; color: #ff6b6b;">æ±‡ç‡åŠ è½½å¤±è´¥</p>';
            }
        }
        
        // ========== ä½ç½®API ==========
        async function fetchLocation() {
            const content = document.getElementById('location-content');
            content.innerHTML = '<div class="loading"><div class="spinner"></div><p>åŠ è½½ä¸­...</p></div>';
            
            try {
                const response = await fetch(`${BASE_URL}/tools/execute?tool_id=baidu_map.ip_location.retrieve.v1`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${API_KEY}` },
                    body: JSON.stringify({ search_id: '', session_id: '', parameters: {}, max_response_size: 20480 })
                });
                const data = await response.json();
                
                if (data.success && data.result?.data) {
                    const loc = data.result.data;
                    const addrDetail = loc.content?.address_detail || {};
                    
                    content.innerHTML = `
                        <div class="location-item"><div class="location-icon"><i class="fas fa-globe"></i></div><div><div class="location-label">å›½å®¶</div><div class="location-value">${loc.address?.split('|')[0] || 'ä¸­å›½'}</div></div></div>
                        <div class="location-item"><div class="location-icon"><i class="fas fa-map"></i></div><div><div class="location-label">çœä»½</div><div class="location-value">${addrDetail.province || 'æœªçŸ¥'}</div></div></div>
                        <div class="location-item"><div class="location-icon"><i class="fas fa-city"></i></div><div><div class="location-label">åŸå¸‚</div><div class="location-value">${addrDetail.city || 'æœªçŸ¥'}</div></div></div>
                        <div class="location-item"><div class="location-icon"><i class="fas fa-map-pin"></i></div><div><div class="location-label">åŒºåŸŸä»£ç </div><div class="location-value">${addrDetail.adcode || 'æœªçŸ¥'}</div></div></div>
                        <div class="location-item"><div class="location-icon"><i class="fas fa-map-marker-alt"></i></div><div><div class="location-label">å®Œæ•´åœ°å€</div><div class="location-value">${loc.content?.address || 'æœªçŸ¥'}</div></div></div>
                    `;
                } else {
                    content.innerHTML = '<p style="text-align: center; color: #ff6b6b;">ä½ç½®åŠ è½½å¤±è´¥</p>';
                }
            } catch (error) {
                console.error('Location error:', error);
                content.innerHTML = '<p style="text-align: center; color: #ff6b6b;">ä½ç½®åŠ è½½å¤±è´¥</p>';
            }
        }
        
        // ========== å›¾ç‰‡ç”ŸæˆAPI ==========
        async function generateImage() {
            const prompt = document.getElementById('image-prompt').value.trim();
            const size = document.getElementById('image-size').value;
            const result = document.getElementById('image-result');
            
            if (!prompt) { alert('è¯·è¾“å…¥å›¾ç‰‡æè¿°'); return; }
            
            result.innerHTML = '<div class="loading"><div class="spinner"></div><p>ç”Ÿæˆä¸­... (å¯èƒ½éœ€è¦10-30ç§’)</p></div>';
            
            try {
                const response = await fetch(`${BASE_URL}/tools/execute?tool_id=bigmodel.images.generation.create.v1`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${API_KEY}` },
                    body: JSON.stringify({ search_id: '', session_id: '', parameters: { model: 'cogview-3', prompt: prompt, size: size }, max_response_size: 102400 })
                });
                const data = await response.json();
                
                let imageUrl = null;
                if (data.success && data.result?.data?.data?.[0]?.url) {
                    imageUrl = data.result.data.data[0].url;
                }
                
                if (imageUrl) {
                    result.innerHTML = `
                        <div class="image-result">
                            <p style="color: #00b894; text-align: center; margin-bottom: 10px;">âœ… å›¾ç‰‡ç”ŸæˆæˆåŠŸ!</p>
                            <img src="${imageUrl}" class="generated-image" style="max-width: 100%; border-radius: 10px; cursor: pointer;" onclick="window.open('${imageUrl}', '_blank')">
                            <p style="color: #888; text-align: center; font-size: 0.8em; margin-top: 10px;">ç‚¹å‡»å›¾ç‰‡æŸ¥çœ‹å¤§å›¾</p>
                        </div>
                    `;
                } else {
                    result.innerHTML = '<p style="text-align: center; color: #ff6b6b;">âŒ å›¾ç‰‡ç”Ÿæˆå¤±è´¥</p>';
                }
            } catch (error) {
                console.error('Image error:', error);
                result.innerHTML = '<p style="text-align: center; color: #ff6b6b;">âŒ å›¾ç‰‡ç”Ÿæˆå¤±è´¥</p>';
            }
        }
        
        // ========== APIæ¢ç´¢å™¨ ==========
        let currentSearchId = '';
        
        async function searchTools(keyword = null) {
            let query = keyword || document.getElementById('tool-search').value.trim();
            const list = document.getElementById('tools-list');
            
            if (!query) {
                list.innerHTML = `
                    <div style="text-align: center; padding: 20px;">
                        <p style="color: #888; margin-bottom: 15px;">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®æˆ–è¾“å…¥å…³é”®è¯æœç´¢å·¥å…·</p>
                        <div style="display: flex; flex-wrap: wrap; justify-content: center; gap: 8px;">
                            ${['å¤©æ°”', 'è‚¡ç¥¨', 'AI', 'æ–°é—»', 'å›¾ç‰‡', 'ç¿»è¯‘', 'åœ°å›¾', 'é‡‘è'].map(kw => `<button class="quick-btn" onclick="searchTools('${kw}')">${kw}</button>`).join('')}
                        </div>
                    </div>
                `;
                return;
            }
            
            list.innerHTML = '<div class="loading"><div class="spinner"></div><p>æœç´¢ä¸­...</p></div>';
            
            try {
                const response = await fetch(`${BASE_URL}/search`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${API_KEY}` },
                    body: JSON.stringify({ query: query, limit: 10 })
                });
                const data = await response.json();
                
                if (data.results && data.results.length > 0) {
                    currentSearchId = data.search_id || '';
                    const total = data.total || data.results.length;
                    
                    list.innerHTML = `
                        <p style="margin-bottom: 15px; color: #00b894;">âœ… æ‰¾åˆ° ${total} ä¸ªå·¥å…·</p>
                        ${data.results.map(t => {
                            const params = t.examples?.sample_parameters || {};
                            const paramStr = JSON.stringify(params).replace(/"/g, '&quot;');
                            return `
                                <div class="tool-item" onclick='executeTool("${t.tool_id}", ${paramStr})'>
                                    <div class="tool-name"><i class="fas fa-cube"></i> ${t.name || 'æœªçŸ¥å·¥å…·'}</div>
                                    <div class="tool-desc">${(t.description || '').replace(/<[^>]*>/g, '').slice(0, 200)}...</div>
                                    <div class="tool-meta">
                                        <span><i class="fas fa-building"></i> ${(t.provider_description || '').split('.')[0] || 'æœªçŸ¥'}</span>
                                        ${t.stats ? `<span><i class="fas fa-bolt"></i> ${t.stats.avg_execution_time_ms?.toFixed(0) || 0}ms</span>` : ''}
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    `;
                } else {
                    list.innerHTML = `<p style="text-align: center; color: #f39c12;">æœªæ‰¾åˆ° "${query}" ç›¸å…³å·¥å…·ï¼Œè¯•è¯•å…¶ä»–å…³é”®è¯ã€‚</p>`;
                }
            } catch (error) {
                console.error('Search error:', error);
                list.innerHTML = '<p style="text-align: center; color: #ff6b6b;">æœç´¢å¤±è´¥</p>';
            }
        }
        
        async function executeTool(toolId, params) {
            const modal = document.getElementById('result-modal');
            const body = document.getElementById('modal-body');
            modal.classList.add('show');
            body.innerHTML = '<div class="loading"><div class="spinner"></div><p>æ‰§è¡Œä¸­...</p></div>';
            
            try {
                const response = await fetch(`${BASE_URL}/tools/execute?tool_id=${toolId}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${API_KEY}` },
                    body: JSON.stringify({ search_id: currentSearchId, session_id: '', parameters: params, max_response_size: 20480 })
                });
                const data = await response.json();
                
                if (data.success !== false && data.result) {
                    const content = data.result.data || data.result;
                    body.innerHTML = `<pre>${JSON.stringify(content, null, 2)}</pre><p style="color: #00b894; margin-top: 15px;">âœ… æ‰§è¡ŒæˆåŠŸ! è€—æ—¶: ${(data.elapsed_time_ms || 0).toFixed(0)}ms</p>`;
                } else {
                    body.innerHTML = `<p style="color: #ff6b6b;">æ‰§è¡Œå¤±è´¥: ${data.error_message || 'æœªçŸ¥é”™è¯¯'}</p>`;
                }
            } catch (error) {
                console.error('Execute error:', error);
                body.innerHTML = `<p style="color: #ff6b6b;">æ‰§è¡Œå¤±è´¥: ${error.message}</p>`;
            }
        }
        
        function closeModal() {
            document.getElementById('result-modal').classList.remove('show');
        }
    </script>
</body>
</html>
